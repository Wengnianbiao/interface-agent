(function(){"use strict";var e={7120:function(e,t,o){var a=o(417);const n=a.A.create({baseURL:"",timeout:5e3});t.A=n},8964:function(e,t,o){var a=o(2856),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("el-container",{staticStyle:{height:"100vh"}},[t("el-aside",{staticStyle:{height:"100%"},attrs:{width:"200px"}},[t("NavHeader")],1),t("el-container",[t("el-main",[t("router-view")],1)],1)],1)],1)},s=[],i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"navbar"},[t("el-menu",{staticClass:"el-menu-vertical-demo",staticStyle:{height:"100%","overflow-y":"auto"},attrs:{"default-active":e.activeIndex,mode:"vertical","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"1"}},[t("i",{staticClass:"el-icon-house"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("首页")])]),t("el-submenu",{attrs:{index:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-document"}),t("span",[e._v("工作流管理")])]),t("el-menu-item",{attrs:{index:"2-1"}},[e._v("工作流管理")]),t("el-menu-item",{attrs:{index:"2-2"}},[e._v("接口管理")]),t("el-menu-item",{attrs:{index:"2-3"}},[e._v("接口参数配置管理")]),t("el-menu-item",{attrs:{index:"2-4"}},[e._v("接口调用日志")])],2),t("el-menu-item",{attrs:{index:"3"}},[t("i",{staticClass:"el-icon-setting"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("系统设置")])]),t("el-submenu",{attrs:{index:"4"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v("用户中心")])]),t("el-menu-item",{attrs:{index:"4-1"}},[e._v("个人信息")]),t("el-menu-item",{attrs:{index:"4-2"}},[e._v("修改密码")]),t("el-menu-item",{attrs:{index:"4-3"}},[e._v("退出登录")])],2)],1)],1)},r=[],l=(o(4114),{name:"NavHeader",data(){return{activeIndex:"1"}},methods:{handleSelect(e){const t=this.$route.path;switch(e){case"1":"/"!==t&&this.$router.push("/");break;case"2-1":"/workflow"!==t&&this.$router.push("/workflow");break;case"2-2":"/workflow/nodes"!==t&&this.$router.push("/workflow/nodes");break;case"2-3":"/workflow/node/param/config"!==t&&this.$router.push("/workflow/node/param/config");break;case"2-4":"/invoke/log"!==t&&this.$router.push("/invoke/log");break;case"3":"/settings"!==t&&this.$router.push("/settings");break;case"4-3":console.log("退出登录");break;default:console.log("未知菜单项")}}},mounted(){const e=this.$route.path;"/"===e?this.activeIndex="1":"/workflow"===e?this.activeIndex="2-1":"/workflow/nodes"===e?this.activeIndex="2-2":"/workflow/node/param/config"===e?this.activeIndex="2-3":"/invoke/log"===e&&(this.activeIndex="2-4")},watch:{$route(e){"/"===e.path?this.activeIndex="1":"/workflow"===e.path?this.activeIndex="2-1":"/workflow/nodes"===e.path?this.activeIndex="2-2":"/workflow/node/param/config"===e.path?this.activeIndex="2-3":"/invoke/log"===e.path&&(this.activeIndex="2-4")}}}),c=l,d=o(1656),u=(0,d.A)(c,i,r,!1,null,"788d9d02",null),p=u.exports,f={name:"App",components:{NavHeader:p}},m=f,h=(0,d.A)(m,n,s,!1,null,null,null),g=h.exports,v=o(4927),w=o.n(v),b=o(1594),y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"workflow-list"},[t("h2",[e._v("工作流管理")]),t("div",{staticStyle:{"margin-bottom":"10px","text-align":"right"}},[t("el-button",{attrs:{type:"success"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.workflows,fit:"true"}},[t("el-table-column",{attrs:{prop:"flowName",label:"工作流名称","min-width":"200"}}),t("el-table-column",{attrs:{prop:"interfaceUri",label:"接口URI","min-width":"250"}}),t("el-table-column",{attrs:{prop:"contentType",label:"入参类型","min-width":"150"}}),t("el-table-column",{attrs:{label:"首节点","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(o){return e._l(o.row.firstFlowNodeNames,function(o){return t("el-tag",{key:o,staticStyle:{"margin-right":"5px"},attrs:{size:"small"}},[e._v(" "+e._s(o)+" ")])})}}])}),t("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-tag",{attrs:{type:1===o.row.status?"success":"danger"}},[e._v(" "+e._s(1===o.row.status?"启用":"禁用")+" ")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(o.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleCopy(o.row)}}},[e._v("复制")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete(o.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":e.pagination.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"工作流名称",prop:"flowName"}},[t("el-input",{attrs:{placeholder:"请输入工作流名称"},model:{value:e.form.flowName,callback:function(t){e.$set(e.form,"flowName",t)},expression:"form.flowName"}})],1),t("el-form-item",{attrs:{label:"接口URI",prop:"interfaceUri"}},[t("el-input",{attrs:{placeholder:"请输入接口URI"},model:{value:e.form.interfaceUri,callback:function(t){e.$set(e.form,"interfaceUri",t)},expression:"form.interfaceUri"}})],1),t("el-form-item",{attrs:{label:"入参类型",prop:"contentType"}},[t("el-select",{attrs:{placeholder:"请选择入参类型"},model:{value:e.form.contentType,callback:function(t){e.$set(e.form,"contentType",t)},expression:"form.contentType"}},[t("el-option",{attrs:{label:"JSON",value:"JSON"}}),t("el-option",{attrs:{label:"XML",value:"XML"}})],1)],1),t("el-form-item",{attrs:{label:"入参元信息",prop:"contentMateInfo"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入入参元信息"},model:{value:e.form.contentMateInfo,callback:function(t){e.$set(e.form,"contentMateInfo",t)},expression:"form.contentMateInfo"}})],1),t("el-form-item",{attrs:{label:"首节点",prop:"firstFlowNodes"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择首节点"},model:{value:e.form.firstFlowNodes,callback:function(t){e.$set(e.form,"firstFlowNodes",t)},expression:"form.firstFlowNodes"}},e._l(e.nodeOptions,function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})}),1)],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[t("el-radio",{attrs:{label:1}},[e._v("启用")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],1)},k=[],x=(o(8111),o(7588),o(1701),o(7120));function N(e){return(0,x.A)({url:"/v1/console/workflow/all",method:"get",params:e})}function S(e){return(0,x.A)({url:`/v1/console/workflow/delete/${e}`,method:"delete"})}function _(e){return(0,x.A)({url:"/v1/console/workflow/create",method:"post",data:e})}function I(e){return(0,x.A)({url:"/v1/console/workflow/update",method:"post",data:e})}function C(){return(0,x.A)({url:"/v1/console/node/all-unpaged",method:"get"})}var $={name:"WorkFlowList",data(){return{workflows:[],loading:!1,pagination:{total:0,pageNum:1,pageSize:10},dialogVisible:!1,dialogTitle:"编辑工作流",form:{flowName:"",interfaceUri:"",contentType:"JSON",contentMateInfo:"",firstFlowNodes:[],status:1},rules:{flowName:[{required:!0,message:"请输入工作流名称",trigger:"blur"}],interfaceUri:[{required:!0,message:"请输入接口URI",trigger:"blur"}],contentType:[{required:!0,message:"请选择入参类型",trigger:"change"},{type:"enum",enum:["JSON","XML"],message:"入参类型只能是 JSON 或 XML",trigger:"change"}],firstFlowNodes:[{required:!0,message:"请选择首节点",trigger:"change"}]},nodeOptions:[],nodeMap:new Map,currentEditingFlowId:null}},mounted(){this.fetchNodeList()},methods:{async fetchWorkflows(){this.loading=!0;try{const e={pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize},t=await N(e);if(200===t.status&&"200"===t.data.code){const e=t.data.rsp;this.workflows=(e.rows||[]).map(e=>({...e,firstFlowNodeNames:e.firstFlowNodes.map(e=>this.nodeMap.get(e))})),this.pagination.total=e.total||0}else this.$message.error("获取工作流列表失败: "+t.data.message)}catch(e){this.$message.error("获取工作流列表失败: "+e.message)}finally{this.loading=!1}},handleSizeChange(e){this.pagination.pageSize=e,this.pagination.pageNum=1,this.fetchWorkflows()},handleCurrentChange(e){this.pagination.pageNum=e,this.fetchWorkflows()},async fetchNodeList(){try{const e=await C();200===e.status&&"200"===e.data.code?(this.nodeOptions=e.data.rsp||[],this.nodeMap=new Map,this.nodeOptions.forEach(e=>{this.nodeMap.set(e.nodeId,e.nodeName)}),this.fetchWorkflows()):this.$message.error("获取节点列表失败: "+e.data.message)}catch(e){this.$message.error("获取节点列表失败: "+e.message)}},handleAdd(){this.resetForm(),this.dialogTitle="新增工作流",this.dialogVisible=!0},handleEdit(e){this.form={flowName:e.flowName,interfaceUri:e.interfaceUri,contentType:e.contentType,contentMateInfo:e.contentMateInfo,firstFlowNodes:e.firstFlowNodes,status:e.status},this.currentEditingFlowId=e.flowId,this.dialogTitle="编辑工作流",this.dialogVisible=!0},handleCopy(e){this.form={flowName:e.flowName+"（副本）",interfaceUri:e.interfaceUri,contentType:e.contentType,contentMateInfo:e.contentMateInfo,firstFlowNodes:e.firstFlowNodes,status:e.status},this.currentEditingFlowId=null,this.dialogTitle="复制工作流",this.dialogVisible=!0},handleDelete(e){this.$confirm(`确定要删除工作流 "${e.flowName}" 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await S(e.flowId),this.$message.success("删除成功"),this.fetchWorkflows()}catch(t){this.$message.error("删除失败: "+t.message)}}).catch(()=>{})},resetForm(){this.$refs.form?.resetFields(),this.form={flowName:"",interfaceUri:"",contentType:"JSON",contentMateInfo:"",firstFlowNodes:[],status:1},this.currentEditingFlowId=null},submitForm(){this.$refs.form.validate(async e=>{if(e)try{let e;if(this.currentEditingFlowId){const t={...this.form,flowId:this.currentEditingFlowId};e=await I(t)}else{const t={...this.form};e=await _(t)}200===e.status&&"200"===e.data.code?(this.$message.success("保存成功"),this.dialogVisible=!1,this.fetchWorkflows()):this.$message.error("保存失败: "+e.data.message)}catch(t){this.$message.error("保存失败: "+t.message)}})},removeIdFields(e){const t={...e};return t}}},T=$,J=(0,d.A)(T,y,k,!1,null,"cd4a403c",null),F=J.exports,j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"workflow-node-list"},[t("h2",[e._v("工作流节点")]),t("div",{staticStyle:{"margin-bottom":"10px","background-color":"#f5f7fa",padding:"20px","border-radius":"4px"}},[t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",gap:"20px"}},[t("div",{staticStyle:{display:"flex","align-items":"center",gap:"8px"}},[t("span",{staticStyle:{"font-size":"14px",color:"#666"}},[e._v("归属工作流")]),t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"全部",clearable:""},on:{change:e.handleFilterChange},model:{value:e.filterFlowId,callback:function(t){e.filterFlowId=t},expression:"filterFlowId"}},e._l(e.workflowOptions,function(e){return t("el-option",{key:e.flowId,attrs:{label:e.flowName,value:e.flowId}})}),1)],1),t("div",{staticStyle:{display:"flex",gap:"10px"}},[t("el-button",{on:{click:e.resetFilters}},[e._v("重置")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleAdd}},[e._v("新增")])],1)])]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.nodes}},[t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",width:"150"}}),t("el-table-column",{attrs:{label:"所属工作流",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getFlowName(t.row.flowId))+" ")]}}])}),t("el-table-column",{attrs:{label:"节点类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(o.row.nodeType))])]}}])}),t("el-table-column",{attrs:{label:"节点元数据信息","show-overflow-tooltip":"","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticClass:"json-container",on:{click:function(t){return e.openJsonDialog(o.row.metaInfo,"节点元数据信息")}}},[t("pre",{staticClass:"json-preview"},[e._v(e._s(e.formatJsonPreview(o.row.metaInfo)))]),t("div",{staticClass:"json-overlay"},[e._v("点击查看详情")])])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"400",fixed:"right","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticStyle:{display:"flex","justify-content":"flex-end",gap:"8px","margin-bottom":"8px"}},[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(o.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleCopy(o.row)}}},[e._v("复制")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete(o.row)}}},[e._v("删除")])],1),t("div",{staticStyle:{display:"flex","justify-content":"flex-end",gap:"8px"}},[t("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.exportNodeParams(o.row)}}},[e._v("导出参数配置")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleImportClick(o.row)}}},[e._v("导入参数配置")])],1)]}}])})],1),e.loading||0!==e.nodes.length?e._e():t("div",{staticStyle:{"text-align":"center",padding:"20px",color:"#999"}},[e._v(" 暂无节点数据 ")]),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":e.pagination.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"节点名称",prop:"nodeName"}},[t("el-input",{attrs:{placeholder:"请输入节点名称"},model:{value:e.form.nodeName,callback:function(t){e.$set(e.form,"nodeName",t)},expression:"form.nodeName"}})],1),t("el-form-item",{attrs:{label:"所属工作流",prop:"flowId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属工作流",clearable:""},model:{value:e.form.flowId,callback:function(t){e.$set(e.form,"flowId",e._n(t))},expression:"form.flowId"}},e._l(e.workflowOptions,function(e){return t("el-option",{key:e.flowId,attrs:{label:e.flowName,value:e.flowId}})}),1)],1),t("el-form-item",{attrs:{label:"节点类型",prop:"nodeType"}},[t("el-select",{attrs:{placeholder:"请选择节点类型"},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[t("el-option",{attrs:{label:"HTTP",value:"HTTP"}}),t("el-option",{attrs:{label:"WEBSERVICE",value:"WEBSERVICE"}}),t("el-option",{attrs:{label:"数据库",value:"DATABASE"}})],1)],1),t("el-form-item",{attrs:{label:"调度参数类型",prop:"scheduleParamSourceType"}},[t("el-select",{attrs:{placeholder:"请选择调度参数类型",clearable:""},model:{value:e.form.scheduleParamSourceType,callback:function(t){e.$set(e.form,"scheduleParamSourceType",t)},expression:"form.scheduleParamSourceType"}},[t("el-option",{attrs:{label:"原始入参",value:"ORIGINAL"}}),t("el-option",{attrs:{label:"上个节点响应",value:"PRE_RESPONSE"}})],1)],1),t("el-form-item",{attrs:{label:"调度表达式",prop:"scheduleExpr"}},[t("el-input",{attrs:{placeholder:"请输入调度表达式"},model:{value:e.form.scheduleExpr,callback:function(t){e.$set(e.form,"scheduleExpr",t)},expression:"form.scheduleExpr"}})],1),t("el-form-item",{attrs:{label:"参数过滤表达式",prop:"paramFilterExpr"}},[t("el-input",{attrs:{placeholder:"请输入参数过滤表达式"},model:{value:e.form.paramFilterExpr,callback:function(t){e.$set(e.form,"paramFilterExpr",t)},expression:"form.paramFilterExpr"}})],1),t("el-form-item",{attrs:{label:"节点元数据信息",prop:"metaInfo"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:'请输入JSON格式的元数据，例如：{"url":"http://xxx","method":"POST"}'},model:{value:e.form.metaInfo,callback:function(t){e.$set(e.form,"metaInfo",t)},expression:"form.metaInfo"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:e.jsonDialogTitle,visible:e.jsonDialogVisible,width:"80%",top:"20px"},on:{"update:visible":function(t){e.jsonDialogVisible=t},close:e.resetJsonDialog}},[t("div",{staticClass:"json-detail-container"},[t("json-viewer",{staticClass:"left-aligned-json",attrs:{value:e.parsedJson,"expand-depth":3,copyable:!1,sort:!1},scopedSlots:e._u([{key:"copy",fn:function(){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return t.stopPropagation(),e.copyJson.apply(null,arguments)}}},[e._v("复制内容")])]},proxy:!0}])})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.copyJson}},[e._v("复制内容")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.jsonDialogVisible=!1}}},[e._v("关闭")])],1)])],1)},E=[],O=(o(4603),o(7566),o(8721),o(8958)),z=o.n(O),A={name:"WorkflowNode",components:{JsonViewer:z()},data(){return{nodes:[],loading:!1,dialogVisible:!1,dialogTitle:"编辑节点",filterFlowId:null,form:{nodeId:"",nodeName:"",flowId:null,nodeType:"HTTP",metaInfo:"{}",scheduleParamSourceType:"",scheduleExpr:"",paramFilterExpr:""},rules:{nodeName:[{required:!0,message:"请输入节点名称",trigger:"blur"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],scheduleExpr:[{validator:this.validateScheduleExpr,trigger:"blur"}],metaInfo:[{required:!0,message:"请输入节点元数据信息",trigger:"blur"},{validator:this.validateJson,trigger:"blur"}]},workflowOptions:[],flowIdToNameMap:new Map,pagination:{total:0,pageNum:1,pageSize:10},currentNode:null,jsonDialogVisible:!1,jsonDialogTitle:"",currentJson:"",parsedJson:null}},mounted(){this.fetchNodes(),this.fetchWorkflows()},methods:{validateJson(e,t,o){try{JSON.parse(t),o()}catch(a){o(new Error("请输入有效的JSON格式"))}},validateScheduleExpr(e,t,o){o()},async fetchNodes(){this.loading=!0;try{const e={pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize};this.filterFlowId&&(e.flowId=this.filterFlowId);const t=await x.A.get("/v1/console/node/all",{params:e});if(200===t.status&&"200"===t.data.code){const e=t.data.rsp;this.nodes=e.rows||[],this.pagination.total=e.total||0}else this.$message.error("获取节点列表失败: "+t.data.message)}catch(e){this.$message.error("获取节点列表失败: "+e.message)}finally{this.loading=!1}},async fetchWorkflows(){try{const e=await x.A.get("/v1/console/workflow/all-unpaged");if(200===e.status&&"200"===e.data.code){const t=Array.isArray(e.data.rsp)?e.data.rsp:[];this.workflowOptions=t,this.flowIdToNameMap.clear(),t.forEach(e=>{this.flowIdToNameMap.set(e.flowId,e.flowName)})}else this.$message.error("获取工作流列表失败: "+e.data.message)}catch(e){this.$message.error("获取工作流列表失败: "+e.message)}},getFlowName(e){return this.flowIdToNameMap.get(e)||"未分配"},handleFilterChange(){this.pagination.pageNum=1,this.fetchNodes()},resetFilters(){this.filterFlowId=null,this.pagination.pageNum=1,this.fetchNodes()},handleAdd(){this.resetForm(),this.dialogTitle="新增节点",this.dialogVisible=!0},handleEdit(e){this.form=JSON.parse(JSON.stringify(e)),this.dialogTitle="编辑节点",this.dialogVisible=!0},handleCopy(e){const t=JSON.parse(JSON.stringify(e));t.nodeId="",t.nodeName=`${t.nodeName}（副本）`,t.flowId=null,t.scheduleExpr="",t.paramFilterExpr="",this.form=t,this.dialogTitle="复制节点",this.dialogVisible=!0},handleDelete(e){this.$confirm(`确定要删除节点 "${e.nodeName}" 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await x.A.delete(`/v1/console/node/${e.nodeId}`),this.$message.success("删除成功"),this.fetchNodes()}catch(t){this.$message.error("删除失败: "+t.message)}}).catch(()=>{})},async exportNodeParams(e){if(e.nodeId)try{this.loading=!0;const t=await x.A.get(`/v1/console/node/export/${e.nodeId}`);if(200!==t.status||"200"!==t.data.code){const e=t.data?.message||"导出接口响应异常";return void this.$message.error(`参数配置导出失败: ${e}`)}const o=t.data.rsp;if(!o)return void this.$message.info("该节点没有参数配置数据");const a=JSON.stringify(o,null,2),n=new Blob([a],{type:"application/json; charset=utf-8"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=`${e.nodeName}_参数配置_${(new Date).getTime()}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),this.$message.success("参数配置导出成功")}catch(t){const e=t?.message||"未知错误";this.$message.error(`参数配置导出失败: ${e}`)}finally{this.loading=!1}else this.$message.error("节点ID不存在，无法导出参数配置")},handleImportClick(e){this.currentNode=e;const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{e.target.files.length>0&&this.handleFileUpload(e)},t.click()},async handleFileUpload(e){const t=e.target.files[0];if(t)if("application/json"===t.type||t.name.endsWith(".json"))try{this.loading=!0;const e=new FormData;e.append("nodeId",this.currentNode.nodeId),e.append("file",t);const o=await x.A.post("/v1/console/node/import",e,{headers:{"Content-Type":"multipart/form-data"}});200===o.status&&"200"===o.data.code?this.$message.success("参数配置导入成功"):this.$message.error("参数配置导入失败: "+(o.data.message||"未知错误"))}catch(o){this.$message.error("参数配置导入失败: "+o.message)}finally{this.loading=!1}else this.$message.error("请上传JSON格式的文件")},resetForm(){this.$refs.form?.resetFields(),this.form={nodeId:"",nodeName:"",flowId:null,nodeType:"HTTP",metaInfo:"{}",scheduleParamSourceType:"",scheduleExpr:"",paramFilterExpr:""}},submitForm(){this.$refs.form.validate(async e=>{if(e){const e={...this.form};Object.keys(e).forEach(t=>{""===e[t]&&(e[t]=null)});try{let t;t=this.form.nodeId?await x.A.post("/v1/console/node/update",e):await x.A.post("/v1/console/node/create",e),200===t.status&&"200"===t.data.code?(this.$message.success("保存成功"),this.dialogVisible=!1,this.fetchNodes()):this.$message.error("保存失败: "+t.data.message)}catch(t){this.$message.error("保存失败: "+t.message)}}})},handleSizeChange(e){this.pagination.pageSize=e,this.pagination.pageNum=1,this.fetchNodes()},handleCurrentChange(e){this.pagination.pageNum=e,this.fetchNodes()},formatJsonPreview(e){try{if(!e)return"无数据";const t=JSON.parse(e),o=JSON.stringify(t,null,2),a=o.split("\n");return a.length>3?[...a.slice(0,3),"  ..."].join("\n"):o}catch(t){return e.length>100?e.substring(0,100)+"...":e}},openJsonDialog(e,t){this.jsonDialogTitle=t,this.currentJson=e||"";try{this.parsedJson=e?JSON.parse(e):null}catch(o){this.parsedJson={error:"Invalid JSON format",content:e}}this.jsonDialogVisible=!0},copyJson(){const e=this.currentJson||"";e?navigator.clipboard&&"function"===typeof navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{this.$message.success("已复制到剪贴板")}).catch(t=>{console.error("Clipboard error:",t),this.fallbackCopy(e)}):this.fallbackCopy(e):this.$message.warning("无内容可复制")},fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),this.$message.success("已复制到剪贴板")}catch(o){this.$message.error("复制失败，请手动复制")}document.body.removeChild(t)},resetJsonDialog(){this.parsedJson=null,this.currentJson="",this.jsonDialogTitle=""}}},D=A,L=(0,d.A)(D,j,E,!1,null,"1d16da3b",null),M=L.exports,P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"invoke-log"},[t("h2",[e._v("接口调用日志")]),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"接口名称"}},[t("el-select",{attrs:{placeholder:"请选择接口",clearable:""},model:{value:e.searchForm.nodeId,callback:function(t){e.$set(e.searchForm,"nodeId",t)},expression:"searchForm.nodeId"}},[t("el-option",{attrs:{label:"全部",value:""}}),e._l(e.nodeOptions,function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})})],2)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.logList}},[t("el-table-column",{attrs:{label:"接口名称","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.nodeMap.get(t.row.nodeId)||t.row.nodeId)+" ")]}}])}),t("el-table-column",{attrs:{label:"上游业务数据","min-width":"220"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticClass:"json-container",on:{click:function(t){return e.openJsonDialog(o.row.businessData,"上游业务数据")}}},[t("pre",{staticClass:"json-preview"},[e._v(e._s(e.formatJsonPreview(o.row.businessData)))]),t("div",{staticClass:"json-overlay"},[e._v("点击查看详情")])])]}}])}),t("el-table-column",{attrs:{label:"接口调用入参","min-width":"220"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticClass:"json-container",on:{click:function(t){return e.openJsonDialog(o.row.paramBeforeInvoke,"接口调用入参")}}},[t("pre",{staticClass:"json-preview"},[e._v(e._s(e.formatJsonPreview(o.row.paramBeforeInvoke)))]),t("div",{staticClass:"json-overlay"},[e._v("点击查看详情")])])]}}])}),t("el-table-column",{attrs:{label:"接口原始响应","min-width":"220"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticClass:"json-container",on:{click:function(t){return e.openJsonDialog(o.row.remoteInvokeResponse,"接口原始响应")}}},[t("pre",{staticClass:"json-preview"},[e._v(e._s(e.formatJsonPreview(o.row.remoteInvokeResponse)))]),t("div",{staticClass:"json-overlay"},[e._v("点击查看详情")])])]}}])}),t("el-table-column",{attrs:{label:"响应上游数据","min-width":"220"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticClass:"json-container",on:{click:function(t){return e.openJsonDialog(o.row.paramAfterInvoke,"响应上游数据")}}},[t("pre",{staticClass:"json-preview"},[e._v(e._s(e.formatJsonPreview(o.row.paramAfterInvoke)))]),t("div",{staticClass:"json-overlay"},[e._v("点击查看详情")])])]}}])}),t("el-table-column",{attrs:{label:"接口耗时","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.invokeTime)+" ms ")]}}])}),t("el-table-column",{attrs:{label:"调用时间","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createTime))+" ")]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":e.pagination.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.loading||0!==e.logList.length?e._e():t("div",{staticStyle:{"text-align":"center",padding:"20px",color:"#999"}},[e._v(" 暂无调用日志数据 ")]),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.jsonDialogVisible,width:"80%",top:"20px"},on:{"update:visible":function(t){e.jsonDialogVisible=t},close:e.resetJsonDialog}},[t("div",{staticClass:"json-detail-container"},[e.isXmlContent?t("div",[t("div",{staticClass:"xml-container"},[t("pre",{staticClass:"xml-preview"},[e._v(e._s(e.currentJson))])])]):t("div",[t("json-viewer",{staticClass:"left-aligned-json",attrs:{value:e.parsedJson,"expand-depth":3,copyable:!1,sort:!1},scopedSlots:e._u([{key:"copy",fn:function(){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return t.stopPropagation(),e.copyJson.apply(null,arguments)}}},[e._v("复制内容")])]},proxy:!0}])})],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.copyJson}},[e._v("复制内容")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.jsonDialogVisible=!1}}},[e._v("关闭")])],1)])],1)},V=[];function U(e){return(0,x.A)({url:"/v1/console/api-log/all",method:"get",params:e})}function W(){return(0,x.A)({url:"/v1/console/node/all-unpaged",method:"get"})}var R={name:"InvokeLog",components:{JsonViewer:z()},data(){return{searchForm:{nodeId:""},logList:[],loading:!1,pagination:{total:0,pageNum:1,pageSize:10},jsonDialogVisible:!1,dialogTitle:"",currentJson:"",parsedJson:null,nodeOptions:[],nodeMap:new Map,isXmlContent:!1}},mounted(){this.fetchNodeList()},methods:{async fetchNodeList(){try{const e=await W();200===e.status&&"200"===e.data.code?(this.nodeOptions=e.data.rsp||[],this.nodeMap=new Map,this.nodeOptions.forEach(e=>{this.nodeMap.set(e.nodeId,e.nodeName)}),this.fetchLogList()):this.$message.error("获取节点列表失败: "+e.data.message)}catch(e){this.$message.error("获取节点列表失败: "+e.message)}},async fetchLogList(){this.loading=!0;try{const e={nodeId:this.searchForm.nodeId||void 0,pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize},t=await U(e);if(200===t.status&&"200"===t.data.code){const e=t.data.rsp;this.logList=e.rows||[],this.pagination.total=e.total||0}else this.$message.error("获取调用日志列表失败: "+t.data.message)}catch(e){this.$message.error("获取调用日志列表失败: "+e.message)}finally{this.loading=!1}},handleSearch(){this.pagination.pageNum=1,this.fetchLogList()},handleReset(){this.searchForm.nodeId="",this.pagination.pageNum=1,this.fetchLogList()},handleSizeChange(e){this.pagination.pageSize=e,this.pagination.pageNum=1,this.fetchLogList()},handleCurrentChange(e){this.pagination.pageNum=e,this.fetchLogList()},formatJsonPreview(e){if(!e)return"无数据";const t=e.trim().startsWith("<")&&e.trim().endsWith(">");if(t)return e.length>100?e.substring(0,100)+"...":e;try{const t=JSON.parse(e),o=JSON.stringify(t,null,2),a=o.split("\n");return a.length>5?[...a.slice(0,5),"  ..."].join("\n"):o}catch(o){return e.length>100?e.substring(0,100)+"...":e}},formatDateTime(e){if(!e)return"";const t=new Date(e),o=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0"),l=String(t.getMilliseconds()).padStart(3,"0");return`${o}-${a}-${n} ${s}:${i}:${r}.${l}`},openJsonDialog(e,t){if(this.dialogTitle=t,this.currentJson=e||"",this.isXmlContent=!1,!e)return this.parsedJson=null,void(this.jsonDialogVisible=!0);const o=e.trim().startsWith("<")&&e.trim().endsWith(">");if(o)this.isXmlContent=!0,this.parsedJson=null;else try{this.parsedJson=JSON.parse(e)}catch(a){this.parsedJson={error:"Invalid JSON format",content:e}}this.jsonDialogVisible=!0},copyJson(){const e=this.currentJson||"";e?navigator.clipboard&&"function"===typeof navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{this.$message.success("已复制到剪贴板")}).catch(t=>{console.warn("Clipboard API failed:",t),this.fallbackCopy(e)}):this.fallbackCopy(e):this.$message.warning("无内容可复制")},fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.fontSize="12px",document.body.appendChild(t);try{t.select();const e=document.execCommand("copy");e?this.$message.success("已复制到剪贴板"):this.$message.error("复制失败，请手动复制")}catch(o){this.$message.error("复制失败，请手动复制")}document.body.removeChild(t)},resetJsonDialog(){this.parsedJson=null,this.currentJson="",this.dialogTitle="",this.isXmlContent=!1}}},B=R,q=(0,d.A)(B,P,V,!1,null,"44cb2ee6",null),H=q.exports;a["default"].use(b.A);const X=[{path:"/",name:"Dashboard",component:()=>o.e(443).then(o.bind(o,7443))},{path:"/workflow",name:"Workflow",component:F},{path:"/workflow/nodes",name:"WorkflowNode",component:M},{path:"/workflow/node/param/config",name:"NodeParamConfig",component:()=>o.e(781).then(o.bind(o,9781))},{path:"/invoke/log",name:"InvokeLog",component:H}],G=new b.A({mode:"hash",base:"/",routes:X});var K=G;a["default"].use(w()),a["default"].config.productionTip=!1,new a["default"]({router:K,render:e=>e(g)}).$mount("#app")}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=e,function(){o.amdO={}}(),function(){var e=[];o.O=function(t,a,n,s){if(!a){var i=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],s=e[d][2];for(var r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every(function(e){return o.O[e](a[l])})?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,n,s]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce(function(t,a){return o.f[a](e,t),t},[]))}}(),function(){o.u=function(e){return"js/"+e+"."+{443:"a58b7c1e",781:"4db353ac"}[e]+".js"}}(),function(){o.miniCssF=function(e){return"css/"+e+"."+{443:"0e2d7c5d",781:"ae4ad6de"}[e]+".css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="interface-agent:";o.l=function(a,n,s,i){if(e[a])e[a].push(n);else{var r,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+s){r=u;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,o.nc&&r.setAttribute("nonce",o.nc),r.setAttribute("data-webpack",t+s),r.src=a),e[a]=[n];var p=function(t,o){r.onerror=r.onload=null,clearTimeout(f);var n=e[a];if(delete e[a],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach(function(e){return e(o)}),t)return t(o)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){o.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,n,s){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",o.nc&&(i.nonce=o.nc);var r=function(o){if(i.onerror=i.onload=null,"load"===o.type)n();else{var a=o&&o.type,r=o&&o.target&&o.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+r+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=a,l.request=r,i.parentNode&&i.parentNode.removeChild(i),s(l)}};return i.onerror=i.onload=r,i.href=t,a?a.parentNode.insertBefore(i,a.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var o=document.getElementsByTagName("link"),a=0;a<o.length;a++){var n=o[a],s=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(s===e||s===t))return n}var i=document.getElementsByTagName("style");for(a=0;a<i.length;a++){n=i[a],s=n.getAttribute("data-href");if(s===e||s===t)return n}},a=function(a){return new Promise(function(n,s){var i=o.miniCssF(a),r=o.p+i;if(t(i,r))return n();e(a,r,null,n,s)})},n={524:0};o.f.miniCss=function(e,t){var o={443:1,781:1};n[e]?t.push(n[e]):0!==n[e]&&o[e]&&t.push(n[e]=a(e).then(function(){n[e]=0},function(t){throw delete n[e],t}))}}}(),function(){var e={524:0};o.f.j=function(t,a){var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)a.push(n[2]);else{var s=new Promise(function(o,a){n=e[t]=[o,a]});a.push(n[2]=s);var i=o.p+o.u(t),r=new Error,l=function(a){if(o.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var s=a&&("load"===a.type?"missing":a.type),i=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",r.name="ChunkLoadError",r.type=s,r.request=i,n[1](r)}};o.l(i,l,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,s,i=a[0],r=a[1],l=a[2],c=0;if(i.some(function(t){return 0!==e[t]})){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(l)var d=l(o)}for(t&&t(a);c<i.length;c++)s=i[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(d)},a=self["webpackChunkinterface_agent"]=self["webpackChunkinterface_agent"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[504],function(){return o(8964)});a=o.O(a)})();
//# sourceMappingURL=app.d9ea31d6.js.map