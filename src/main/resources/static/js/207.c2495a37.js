"use strict";(self["webpackChunkinterface_agent"]=self["webpackChunkinterface_agent"]||[]).push([[207],{1207:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"node-param-config"},[t("h2",[e._v("节点参数配置")]),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"节点"}},[t("el-select",{attrs:{placeholder:"请选择节点",clearable:""},model:{value:e.searchForm.nodeId,callback:function(t){e.$set(e.searchForm,"nodeId",t)},expression:"searchForm.nodeId"}},[t("el-option",{attrs:{label:"全部",value:""}}),e._l(e.nodeOptions,function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})})],2)],1),t("el-form-item",{attrs:{label:"处理类型"}},[t("el-select",{attrs:{placeholder:"请选择处理类型",clearable:""},model:{value:e.searchForm.processType,callback:function(t){e.$set(e.searchForm,"processType",t)},expression:"searchForm.processType"}},[t("el-option",{attrs:{label:"前置处理",value:"PRE_PROCESS"}}),t("el-option",{attrs:{label:"后置处理",value:"POST_PROCESS"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.handleReset}},[e._v("重置")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleExport}},[e._v("导出")])],1)],1),t("div",{staticStyle:{"margin-bottom":"10px","text-align":"right"}},[t("el-button",{attrs:{type:"success"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.configList}},[t("el-table-column",{attrs:{label:"节点名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.nodeMap.get(t.row.nodeId)||t.row.nodeId)+" ")]}}])}),t("el-table-column",{attrs:{prop:"paramDesc",label:"参数描述","show-overflow-tooltip":"",width:"200"}}),t("el-table-column",{attrs:{prop:"sourceParamKey",label:"源参数名",width:"150"}}),t("el-table-column",{attrs:{prop:"sourceParamType",label:"源参数类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(a.row.sourceParamType))])]}}])}),t("el-table-column",{attrs:{prop:"targetParamKey",label:"目标参数名",width:"150"}}),t("el-table-column",{attrs:{prop:"targetParamType",label:"目标参数类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(a.row.targetParamType))])]}}])}),t("el-table-column",{attrs:{prop:"processType",label:"处理类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"PRE_PROCESS"===a.row.processType?"primary":"success"}},[e._v(" "+e._s("PRE_PROCESS"===a.row.processType?"前置处理":"后置处理")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"mappingType",label:"映射类型",width:"120"}}),t("el-table-column",{attrs:{prop:"mappingRule",label:"映射规则","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"父参数",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getParentParamName(t.row.parentId))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"250",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleCopy(a.row)}}},[e._v("复制")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":e.pagination.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.loading||0!==e.configList.length?e._e():t("div",{staticStyle:{"text-align":"center",padding:"20px",color:"#999"}},[e._v(" 暂无参数配置数据 ")]),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.editDialogVisible,width:"600px"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.resetEditForm}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"节点",prop:"nodeId"}},[t("el-select",{attrs:{placeholder:"请选择节点"},model:{value:e.editForm.nodeId,callback:function(t){e.$set(e.editForm,"nodeId",t)},expression:"editForm.nodeId"}},e._l(e.nodeOptions,function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})}),1)],1),"NONE"!==e.editForm.sourceParamType?t("el-form-item",{attrs:{label:"源参数名",prop:"sourceParamKey"}},[t("el-input",{attrs:{placeholder:"请输入源参数名"},model:{value:e.editForm.sourceParamKey,callback:function(t){e.$set(e.editForm,"sourceParamKey",t)},expression:"editForm.sourceParamKey"}})],1):e._e(),t("el-form-item",{attrs:{label:"源参数类型",prop:"sourceParamType"}},[t("el-select",{attrs:{placeholder:"请选择源参数类型"},model:{value:e.editForm.sourceParamType,callback:function(t){e.$set(e.editForm,"sourceParamType",t)},expression:"editForm.sourceParamType"}},[t("el-option",{attrs:{label:"字符串",value:"STRING"}}),t("el-option",{attrs:{label:"数字INT",value:"INTEGER"}}),t("el-option",{attrs:{label:"数字LONG",value:"LONG"}}),t("el-option",{attrs:{label:"布尔",value:"BOOLEAN"}}),t("el-option",{attrs:{label:"对象",value:"OBJECT"}}),t("el-option",{attrs:{label:"数组",value:"ARRAY"}}),t("el-option",{attrs:{label:"无",value:"NONE"}})],1)],1),t("el-form-item",{attrs:{label:"目标参数名",prop:"targetParamKey"}},[t("el-input",{attrs:{placeholder:"请输入目标参数名"},model:{value:e.editForm.targetParamKey,callback:function(t){e.$set(e.editForm,"targetParamKey",t)},expression:"editForm.targetParamKey"}})],1),t("el-form-item",{attrs:{label:"父参数",prop:"parentId"}},[t("el-select",{attrs:{placeholder:"请选择父参数",clearable:""},model:{value:e.editForm.parentId,callback:function(t){e.$set(e.editForm,"parentId",t)},expression:"editForm.parentId"}},e._l(e.configParentOptions,function(e){return t("el-option",{key:e.configId,attrs:{label:`${e.targetParamKey} (${e.paramDesc||"无描述"})`,value:e.configId}})}),1)],1),t("el-form-item",{attrs:{label:"目标参数类型",prop:"targetParamType"}},[t("el-select",{attrs:{placeholder:"请选择目标参数类型"},model:{value:e.editForm.targetParamType,callback:function(t){e.$set(e.editForm,"targetParamType",t)},expression:"editForm.targetParamType"}},[t("el-option",{attrs:{label:"字符串",value:"STRING"}}),t("el-option",{attrs:{label:"数字INT",value:"INTEGER"}}),t("el-option",{attrs:{label:"数字LONG",value:"LONG"}}),t("el-option",{attrs:{label:"布尔",value:"BOOLEAN"}}),t("el-option",{attrs:{label:"对象",value:"OBJECT"}}),t("el-option",{attrs:{label:"数组",value:"ARRAY"}}),t("el-option",{attrs:{label:"无",value:"NONE"}})],1)],1),t("el-form-item",{attrs:{label:"处理类型",prop:"processType"}},[t("el-select",{attrs:{placeholder:"请选择处理类型"},model:{value:e.editForm.processType,callback:function(t){e.$set(e.editForm,"processType",t)},expression:"editForm.processType"}},[t("el-option",{attrs:{label:"前置处理",value:"PRE_PROCESS"}}),t("el-option",{attrs:{label:"后置处理",value:"POST_PROCESS"}})],1)],1),t("el-form-item",{attrs:{label:"映射类型",prop:"mappingType"}},[t("el-select",{attrs:{placeholder:"请选择映射类型"},model:{value:e.editForm.mappingType,callback:function(t){e.$set(e.editForm,"mappingType",t)},expression:"editForm.mappingType"}},[t("el-option",{attrs:{label:"固定值",value:"CONSTANT"}}),t("el-option",{attrs:{label:"名称映射",value:"NAME"}}),t("el-option",{attrs:{label:"表达式",value:"EXPRESSION"}})],1)],1),t("el-form-item",{attrs:{label:"映射规则",prop:"mappingRule"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入映射规则"},model:{value:e.editForm.mappingRule,callback:function(t){e.$set(e.editForm,"mappingRule",t)},expression:"editForm.mappingRule"}})],1),t("el-form-item",{attrs:{label:"参数描述",prop:"paramDesc"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入参数描述，例如：响应状态码转换：1->1，其他->-1"},model:{value:e.editForm.paramDesc,callback:function(t){e.$set(e.editForm,"paramDesc",t)},expression:"editForm.paramDesc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitEditForm}},[e._v("确 定")])],1)],1)],1)},s=[],o=(a(4114),a(8111),a(2489),a(116),a(7588),a(3579),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4603),a(7566),a(8721),a(7120)),i={name:"NodeParamConfig",data(){return{searchForm:{nodeId:"",processType:""},configList:[],loading:!1,pagination:{total:0,pageNum:1,pageSize:10},dialogTitle:"编辑参数配置",editDialogVisible:!1,editForm:{configId:"",nodeId:"",parentId:"",sourceParamKey:"",sourceParamType:"",targetParamKey:"",targetParamType:"",processType:"",mappingType:"",mappingRule:"",paramDesc:""},editRules:{nodeId:[{required:!0,message:"请选择节点",trigger:"change"}],parentId:[{required:!1,message:"请选择父参数",trigger:"change"}],sourceParamKey:[{required:!0,message:"请输入源参数名",trigger:"blur"}],sourceParamType:[{required:!0,message:"请选择源参数类型",trigger:"change"}],targetParamKey:[{required:!0,message:"请输入目标参数名",trigger:"blur"}],targetParamType:[{required:!0,message:"请选择目标参数类型",trigger:"change"}],processType:[{required:!0,message:"请选择处理类型",trigger:"change"}],mappingType:[{required:!0,message:"请选择映射类型",trigger:"change"}],mappingRule:[{required:!1,message:"请输入映射规则",trigger:"blur"}],paramDesc:[{required:!1,message:"请输入参数描述",trigger:"blur"}]},nodeOptions:[],nodeMap:new Map,configParentOptions:[],configParentMap:new Map,allParentConfigs:[]}},mounted(){this.fetchNodeList()},watch:{"editForm.sourceParamType"(e){const t=this.editRules.sourceParamKey[0];"NONE"===e?(t.required=!1,this.editForm.sourceParamKey=""):t.required=!0},"editForm.nodeId":function(e){e&&this.fetchConfigParentList()},"editForm.processType":function(e){e&&this.fetchConfigParentList()}},methods:{getParentParamName(e){if(!e)return"";const t=this.allParentConfigs.find(t=>t.configId===e);return t?`${t.targetParamKey} (${t.paramDesc||"无描述"})`:(this.fetchParentParamDetails(e),e)},async fetchParentParamDetails(e){if(!this.loadingParentIds||!this.loadingParentIds.includes(e)){this.loadingParentIds=this.loadingParentIds||[],this.loadingParentIds.push(e);try{const t=await o.A.get(`/v1/console/node-param/${e}`);if(200===t.status&&"200"===t.data.code){const a=t.data.rsp;this.allParentConfigs.some(t=>t.configId===e)||this.allParentConfigs.push(a),this.configParentMap.set(e,a),this.configParentOptions.some(t=>t.configId===e)||this.configParentOptions.push(a),this.$forceUpdate()}}catch(t){console.log("获取父参数详情失败: "+t.message)}finally{this.loadingParentIds=this.loadingParentIds.filter(t=>t!==e)}}},async fetchNodeList(){try{const e=await o.A.get("/v1/console/node/all-unpaged");200===e.status&&"200"===e.data.code?(this.nodeOptions=e.data.rsp||[],this.nodeMap=new Map,this.nodeOptions.forEach(e=>{this.nodeMap.set(e.nodeId,e.nodeName)}),this.fetchAllParentConfigs(),this.fetchConfigList()):this.$message.error("获取节点列表失败: "+e.data.message)}catch(e){this.$message.error("获取节点列表失败: "+e.message)}},async fetchAllParentConfigs(){try{const e=await o.A.get("/v1/console/node-param/all-unpaged");200===e.status&&"200"===e.data.code?(this.allParentConfigs=e.data.rsp||[],this.configParentMap=new Map,this.allParentConfigs.forEach(e=>{this.configParentMap.set(e.configId,e)})):this.$message.error("获取所有父参数配置失败: "+e.data.message)}catch(e){console.log("获取所有父参数配置失败: "+e.message)}},async fetchConfigList(){this.loading=!0;try{const e={nodeId:this.searchForm.nodeId||void 0,processType:this.searchForm.processType||void 0,pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize},t=await o.A.get("/v1/console/node-param/all",{params:e});if(200===t.status&&"200"===t.data.code){const e=t.data.rsp;this.configList=e.rows||[],this.pagination.total=e.total||0,this.loadMissingParentConfigs()}else this.$message.error("获取参数配置列表失败: "+t.data.message)}catch(e){this.$message.error("获取参数配置列表失败: "+e.message)}finally{this.loading=!1}},loadMissingParentConfigs(){const e=new Set;this.configList.forEach(t=>{t.parentId&&e.add(t.parentId)});const t=[];e.forEach(e=>{this.allParentConfigs.some(t=>t.configId===e)||t.push(e)}),t.forEach(e=>{this.fetchParentParamDetails(e)})},async fetchConfigParentList(){try{const e={nodeId:this.editForm.nodeId,processType:this.editForm.processType},t=await o.A.get("/v1/console/node-param/all-unpaged",{params:e});200===t.status&&"200"===t.data.code?this.configParentOptions=(t.data.rsp||[]).filter(e=>!this.editForm.configId||e.configId!==this.editForm.configId):this.$message.error("获取父参数列表失败: "+t.data.message)}catch(e){this.$message.error("获取父参数列表失败: "+e.message)}},handleSearch(){this.pagination.pageNum=1,this.fetchConfigList()},handleReset(){this.searchForm.nodeId="",this.searchForm.processType="",this.pagination.pageNum=1,this.fetchConfigList()},handleSizeChange(e){this.pagination.pageSize=e,this.pagination.pageNum=1,this.fetchConfigList()},handleCurrentChange(e){this.pagination.pageNum=e,this.fetchConfigList()},handleEdit(e){this.editForm={...e},this.editDialogVisible=!0,this.dialogTitle="编辑参数配置",this.fetchConfigParentList()},handleCopy(e){this.editForm={...e,configId:"",paramDesc:e.paramDesc||""},this.editDialogVisible=!0,this.dialogTitle="复制参数配置",this.fetchConfigParentList()},handleDelete(e){this.$confirm("确定要删除参数配置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await o.A.delete(`/v1/console/node-param/${e.configId}`),this.$message.success("删除成功"),this.fetchConfigList(),this.fetchAllParentConfigs()}catch(t){this.$message.error("删除失败: "+t.message)}}).catch(()=>{})},handleAdd(){this.resetEditForm(),this.editDialogVisible=!0,this.dialogTitle="新增参数配置"},resetEditForm(){this.$refs.editForm?.resetFields(),this.editForm={configId:"",nodeId:"",parentId:"",sourceParamKey:"",sourceParamType:"",targetParamKey:"",targetParamType:"",processType:"",mappingType:"",mappingRule:"",paramDesc:""},this.configParentOptions=[]},submitEditForm(){this.$refs.editForm.validate(async e=>{if(e)try{const e={...this.editForm};let t;"NONE"===e.sourceParamType&&(e.sourceParamKey=null),""===e.parentId&&(e.parentId=null),t=e.configId?await o.A.post("/v1/console/node-param/update",e):await o.A.post("/v1/console/node-param/create",e),200===t.status&&"200"===t.data.code?(this.$message.success("保存成功"),this.editDialogVisible=!1,this.fetchConfigList(),this.fetchAllParentConfigs()):this.$message.error("保存失败: "+t.data.message)}catch(t){this.$message.error("保存失败: "+t.message)}})},handleExport(){const e=JSON.stringify(this.configList,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="node-param-config-export.json",r.click(),URL.revokeObjectURL(a)}}},l=i,n=a(1656),c=(0,n.A)(l,r,s,!1,null,"229f5ffd",null),p=c.exports}}]);
//# sourceMappingURL=207.c2495a37.js.map